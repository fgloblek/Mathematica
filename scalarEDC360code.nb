(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     43475,       1271]
NotebookOptionsPosition[     40634,       1225]
NotebookOutlinePosition[     41271,       1246]
CellTagsIndexPosition[     41228,       1243]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["  scalarEDCcode", "Text",
 ShowGroupOpener->True,
 FontFamily->"Helvetica",
 FontSize->24,
 FontWeight->"Bold",
 FontColor->RGBColor[
  0, 0, 1],ExpressionUUID->"29db9172-b6ba-4ad9-a079-d3917fd855d2"],

Cell["\tversion 3.6.0 - May 2007 ", "Text",
 FontSize->14,
 FontColor->RGBColor[
  0, 0, 1],ExpressionUUID->"6a494ef2-5086-4bc7-9685-3092d89ed233"],

Cell[CellGroupData[{

Cell["\<\
\tTo start a new set of calculations, just re-evaluate this notebook without \
first quitting the kernel. All symbols defined previously and all In/Out \
lines will be cleared, though memory used will not be recovered. \
\>", "Text",
 ShowGroupOpener->True,
 FontSize->16,
 FontColor->RGBColor[
  0, 0, 1],ExpressionUUID->"32894a4d-3ddb-47db-9cc3-529cb25fb670"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Off", "[", 
   RowBox[{
    RowBox[{"General", "::", "\"\<spell\>\""}], ",", 
    RowBox[{"General", "::", "\"\<spell1\>\""}], ",", 
    RowBox[{"Remove", "::", "\"\<rmnsm\>\""}], ",", 
    RowBox[{"UpSet", "::", "\"\<write\>\""}]}], "]"}], ";"}]], "Input",
 CellLabel->
  "In[115]:=",ExpressionUUID->"03ffd62a-9899-451f-a3a7-dbfb968a30bd"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Unprotect", "[", "\"\<Global`*\>\"", "]"}], ";", 
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], ";", 
  RowBox[{"Remove", "[", "\"\<Global`*\>\"", "]"}], ";", 
  RowBox[{"Unprotect", "[", 
   RowBox[{"In", ",", "Out"}], "]"}], ";", 
  RowBox[{"Clear", "[", 
   RowBox[{"In", ",", "Out"}], "]"}], ";", 
  RowBox[{"Protect", "[", 
   RowBox[{"In", ",", "Out"}], "]"}], ";", 
  RowBox[{"$Line", "=", "0"}], ";", 
  RowBox[{"$RecursionLimit", "=", "256"}], ";", 
  RowBox[{"$IterationLimit", "=", "4096"}], ";"}]], "Input",
 CellLabel->
  "In[116]:=",ExpressionUUID->"28e5bde6-027d-4dcd-8969-337d25f590f2"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"Forms", "[", "i_", "]"}], ":=", 
   RowBox[{"{", "}"}]}], ";", 
  RowBox[{"AllScalForms", "=", 
   RowBox[{"{", "}"}]}], ";", 
  RowBox[{"AllDifForms", "=", 
   RowBox[{"{", "}"}]}], ";", 
  RowBox[{"AllSymbols", "=", 
   RowBox[{"{", "}"}]}], ";", 
  RowBox[{"FormVars", "=", 
   RowBox[{"{", 
    RowBox[{"_Wedge", ",", "_d"}], "}"}]}], ";", 
  RowBox[{"HeadList", "=", 
   RowBox[{"{", "}"}]}], ";", 
  RowBox[{"ScalHeadList", "=", 
   RowBox[{"{", "}"}]}], ";", 
  RowBox[{"nodHeads", "=", 
   RowBox[{"{", 
    RowBox[{
    "Bar", ",", "Pattern", ",", "Condition", ",", "RuleDelayed", ",", 
     "SeriesData"}], "}"}]}], ";", 
  RowBox[{"$EDCversion", "=", "360"}], ";"}]], "Input",
 CellLabel->"In[1]:=",ExpressionUUID->"7942a5b2-d282-4ce3-9ea5-478fcd31be66"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"zeroQ", "[", "0", "]"}], "=", "True"}], ";", 
  RowBox[{
   RowBox[{"zeroQ", "[", "x_List", "]"}], ":=", 
   RowBox[{"And", "@@", 
    RowBox[{"(", 
     RowBox[{"zeroQ", "/@", 
      RowBox[{"Union", "[", 
       RowBox[{"Flatten", "[", "x", "]"}], "]"}]}], ")"}]}]}], ";", 
  RowBox[{
   RowBox[{"zeroQ", "[", "x_SeriesData", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "===", 
      RowBox[{"{", "}"}]}], ",", "True", ",", "False"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"zeroQ", "[", "x_", "]"}], ":=", "False"}], ";"}]], "Input",
 CellLabel->"In[2]:=",ExpressionUUID->"2966ac07-4dcd-40d1-ac71-a0e46a15a584"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"Bar", ",", 
    RowBox[{"{", "Listable", "}"}]}], "]"}], ";", 
  RowBox[{
   RowBox[{"Bar", "[", 
    RowBox[{"Bar", "[", "x_", "]"}], "]"}], "=", "x"}], ";", 
  RowBox[{
   RowBox[{"Bar", "[", 
    RowBox[{"Complex", "[", 
     RowBox[{"u_", ",", "v_"}], "]"}], "]"}], ":=", 
   RowBox[{"Complex", "[", 
    RowBox[{"u", ",", 
     RowBox[{"-", "v"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"Bar", "[", 
    RowBox[{
    "x_Plus", "|", "x_Times", "|", "x_Wedge", "|", "x_Power", "|", "x_Rule", 
     "|", "x_Equal"}], "]"}], ":=", 
   RowBox[{"Bar", "/@", "x"}]}], ";", 
  RowBox[{
   RowBox[{"Bar", "[", "x_SeriesData", "]"}], ":=", 
   RowBox[{"x", "/.", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       RowBox[{"First", "[", "x", "]"}], "->", 
       RowBox[{"Bar", "[", 
        RowBox[{"First", "[", "x", "]"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{"x", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "->", 
       RowBox[{"Bar", "[", 
        RowBox[{"x", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{"x", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "->", 
       RowBox[{"Bar", "/@", 
        RowBox[{"x", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}]}]}], "}"}]}]}], ";", 
  RowBox[{
   RowBox[{"Bar", "[", 
    RowBox[{"DirectedInfinity", "[", "x_", "]"}], "]"}], ":=", 
   RowBox[{"DirectedInfinity", "[", 
    RowBox[{"Bar", "[", "x", "]"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"Bar", "[", 
    RowBox[{"d", "[", "x_", "]"}], "]"}], ":=", 
   RowBox[{"d", "[", 
    RowBox[{"Bar", "[", "x", "]"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"Bar", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Derivative", "[", "x__", "]"}], "[", "y_", "]"}], "[", "z__", 
     "]"}], "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"Union", "[", 
       RowBox[{"Bar", "[", 
        RowBox[{"{", "z", "}"}], "]"}], "]"}], "===", 
      RowBox[{"Union", "[", 
       RowBox[{"{", "z", "}"}], "]"}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Derivative", "[", 
        RowBox[{"Sequence", "@@", 
         RowBox[{
          RowBox[{"Permutations", "[", 
           RowBox[{"{", "x", "}"}], "]"}], "[", 
          RowBox[{"[", 
           RowBox[{
            RowBox[{"Position", "[", 
             RowBox[{
              RowBox[{"Permutations", "[", 
               RowBox[{"{", "z", "}"}], "]"}], ",", 
              RowBox[{"Bar", "[", 
               RowBox[{"{", "z", "}"}], "]"}]}], "]"}], "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "]"}]}], "]"}], 
       "[", 
       RowBox[{"Bar", "[", "y", "]"}], "]"}], "[", "z", "]"}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Derivative", "[", "x", "]"}], "[", 
       RowBox[{"Bar", "[", "y", "]"}], "]"}], "[", 
      RowBox[{"Sequence", "@@", 
       RowBox[{"Bar", "[", 
        RowBox[{"{", "z", "}"}], "]"}]}], "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"Bar", "[", "x_", "]"}], ":=", 
   RowBox[{"x", "/;", 
    RowBox[{"NumericQ", "[", "x", "]"}]}]}], ";"}]], "Input",
 CellLabel->"In[3]:=",ExpressionUUID->"1fbb3465-c1da-4f3e-bf89-817d941419fd"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"FormDegree", "[", "x_Plus", "]"}], ":=", 
   RowBox[{"FormDegree", "[", 
    RowBox[{"First", "[", "x", "]"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"FormDegree", "[", "x_Times", "]"}], ":=", 
   RowBox[{"Plus", "@@", 
    RowBox[{"FormDegree", "/@", 
     RowBox[{"List", "@@", "x"}]}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FormDegree", "[", "x_Wedge", "]"}], ":=", 
   RowBox[{"Plus", "@@", 
    RowBox[{"FormDegree", "/@", 
     RowBox[{"List", "@@", "x"}]}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FormDegree", "[", 
    RowBox[{"d", "[", "x_", "]"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"FormDegree", "[", 
     RowBox[{"d", "[", "x", "]"}], "]"}], "=", 
    RowBox[{"1", "+", 
     RowBox[{"FormDegree", "[", "x", "]"}]}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FormDegree", "[", "x_List", "]"}], ":=", 
   RowBox[{"FormDegree", "[", 
    RowBox[{"First", "[", 
     RowBox[{"Select", "[", 
      RowBox[{
       RowBox[{"Union", "[", 
        RowBox[{"Flatten", "[", "x", "]"}], "]"}], ",", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"zeroQ", "[", "#", "]"}]}], "&"}]}], "]"}], "]"}], "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FormDegree", "[", 
    RowBox[{"Bar", "[", "x_", "]"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"FormDegree", "[", 
     RowBox[{"Bar", "[", "x", "]"}], "]"}], "=", 
    RowBox[{"FormDegree", "[", "x", "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"FormDegree", "[", "x_SeriesData", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "===", 
      RowBox[{"{", "}"}]}], ",", "0", ",", 
     RowBox[{"FormDegree", "[", 
      RowBox[{"x", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "]"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"FormDegree", "[", "x_", "]"}], ":=", "0"}], ";"}]}], "Input",
 CellLabel->"In[4]:=",ExpressionUUID->"c3e870bb-c655-4ceb-97a4-98dde1fe3a82"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"DeclareForms", "[", "z__", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"h", ",", 
       RowBox[{"x", "=", 
        RowBox[{"{", 
         RowBox[{"{", "z", "}"}], "}"}]}], ",", "xi", ",", "rxi", ",", "k", 
       ",", "oldHeads", ",", "newHeads"}], "}"}], ",", 
     RowBox[{
      RowBox[{"While", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Head", "[", 
          RowBox[{"x", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "===", "List"}], 
        ",", 
        RowBox[{"x", "=", 
         RowBox[{"First", "[", "x", "]"}]}]}], "]"}], ";", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"xi", "=", 
          RowBox[{"x", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", 
         RowBox[{"rxi", "=", 
          RowBox[{"Rest", "[", "xi", "]"}]}], ";", 
         RowBox[{
          RowBox[{"Forms", "[", 
           RowBox[{"First", "[", "xi", "]"}], "]"}], "=", 
          RowBox[{"Union", "[", 
           RowBox[{
            RowBox[{"Forms", "[", 
             RowBox[{"First", "[", "xi", "]"}], "]"}], ",", "rxi"}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"AllScalForms", "=", 
          RowBox[{"Union", "[", 
           RowBox[{"AllScalForms", ",", "rxi"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"h", "=", 
             RowBox[{"Head", "[", 
              RowBox[{"rxi", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "]"}]}], ";", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"h", "===", "Symbol"}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"FormDegree", "[", 
                 RowBox[{"rxi", "[", 
                  RowBox[{"[", "j", "]"}], "]"}], "]"}], "=", 
                RowBox[{"First", "[", "xi", "]"}]}], ";", 
               RowBox[{
                RowBox[{
                 RowBox[{"BasicScalFormQ", "[", 
                  RowBox[{"rxi", "[", 
                   RowBox[{"[", "j", "]"}], "]"}], "]"}], "=", "True"}], 
                ";"}]}], ",", 
              RowBox[{
               RowBox[{
                RowBox[{"FormDegree", "[", "_h", "]"}], "=", 
                RowBox[{"First", "[", "xi", "]"}]}], ";", 
               RowBox[{
                RowBox[{"BasicScalFormQ", "[", "_h", "]"}], "=", "True"}], 
               ";"}]}], "]"}]}], ",", 
           RowBox[{"{", 
            RowBox[{"j", ",", 
             RowBox[{"Length", "[", "rxi", "]"}]}], "}"}]}], "]"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", 
          RowBox[{"Length", "[", "x", "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"AllDifForms", "=", 
       RowBox[{"Union", "[", "AllScalForms", "]"}]}], ";", 
      RowBox[{"oldHeads", "=", "ScalHeadList"}], ";", 
      RowBox[{"ScalHeadList", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"Union", "[", 
          RowBox[{
           RowBox[{"Head", "/@", "AllScalForms"}], ",", "ScalHeadList"}], 
          "]"}], ",", 
         RowBox[{"{", "Symbol", "}"}]}], "]"}]}], ";", 
      RowBox[{"newHeads", "=", 
       RowBox[{"Complement", "[", 
        RowBox[{"ScalHeadList", ",", "oldHeads"}], "]"}]}], ";", 
      RowBox[{"AllSymbols", "=", 
       RowBox[{"Union", "[", "AllDifForms", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"HeadList", "=", 
       RowBox[{"Union", "[", 
        RowBox[{"Head", "/@", "AllSymbols"}], "]"}]}], ";", 
      RowBox[{"DifFormSymbols", "=", 
       RowBox[{"Drop", "[", 
        RowBox[{"AllDifForms", ",", 
         RowBox[{"-", 
          RowBox[{"Length", "[", "ScalHeadList", "]"}]}]}], "]"}]}], ";", 
      "\n", 
      RowBox[{"k", "=", 
       RowBox[{"Thread", "[", 
        RowBox[{"Blank", "[", "ScalHeadList", "]"}], "]"}]}], ";", 
      RowBox[{"FormVars", "=", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", 
         RowBox[{"_Wedge", ",", "_d", ",", 
          RowBox[{"Union", "[", 
           RowBox[{"k", ",", 
            RowBox[{"Bar", "[", "k", "]"}]}], "]"}], ",", 
          RowBox[{
           RowBox[{"u_", "|", 
            RowBox[{"Bar", "[", "u_", "]"}]}], "/;", 
           RowBox[{"MemberQ", "[", 
            RowBox[{"DifFormSymbols", ",", "u"}], "]"}]}], ",", "_tr"}], 
         "}"}], "]"}]}], ";"}]}], "]"}]}], ";"}]], "Input",
 CellLabel->"In[10]:=",ExpressionUUID->"3136833c-22c8-4d1e-a891-d943003ce84c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"NoDif", "[", "z__", "]"}], ":=", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{"nodHeads", "=", 
     RowBox[{"Union", "[", 
      RowBox[{"nodHeads", ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"{", "z", "}"}], "]"}]}], "]"}]}], ";"}], ")"}]}]], "Input",
 CellLabel->"In[11]:=",ExpressionUUID->"dd1385e9-f66b-42b7-a105-4af8a47ac46c"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"BasicScalFormQ", "[", 
    RowBox[{"Bar", "[", "x_", "]"}], "]"}], ":=", 
   RowBox[{"BasicScalFormQ", "[", "x", "]"}]}], ";", 
  RowBox[{
   RowBox[{"BasicScalFormQ", "[", "_d", "]"}], "=", "True"}], ";", 
  RowBox[{
   RowBox[{"BasicScalFormQ", "[", "x_", "]"}], ":=", "False"}], 
  ";"}]], "Input",
 CellLabel->"In[12]:=",ExpressionUUID->"7c015e9e-4d8f-4866-ba78-e0afb2ea2f5d"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"ScalFormQ", "[", "x_Times", "]"}], ":=", 
   RowBox[{"Or", "@@", 
    RowBox[{"ScalFormQ", "/@", 
     RowBox[{"List", "@@", "x"}]}]}]}], ";", 
  RowBox[{
   RowBox[{"ScalFormQ", "[", 
    RowBox[{"x_Wedge", "|", "x_Plus"}], "]"}], ":=", 
   RowBox[{"And", "@@", 
    RowBox[{"ScalFormQ", "/@", 
     RowBox[{"List", "@@", "x"}]}]}]}], ";", 
  RowBox[{
   RowBox[{"ScalFormQ", "[", "x_", "]"}], ":=", 
   RowBox[{"BasicScalFormQ", "[", "x", "]"}]}], ";"}]], "Input",
 CellLabel->"In[13]:=",ExpressionUUID->"0f81c061-325c-4024-bb4a-d34d2aebfe6c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"d", ",", 
    RowBox[{"{", "Listable", "}"}]}], "]"}], ";", 
  RowBox[{
   RowBox[{"d", "[", 
    RowBox[{"x_Times", "|", "x_Wedge"}], "]"}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"d", "[", 
      RowBox[{"First", "[", "x", "]"}], "]"}], "\[Wedge]", 
     RowBox[{"Rest", "[", "x", "]"}]}], "+", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{"-", "1"}], ")"}], "^", 
      RowBox[{"FormDegree", "[", 
       RowBox[{"First", "[", "x", "]"}], "]"}]}], "*", 
     RowBox[{
      RowBox[{"First", "[", "x", "]"}], "\[Wedge]", 
      RowBox[{"d", "[", 
       RowBox[{"Rest", "[", "x", "]"}], "]"}]}]}]}]}], ";", 
  RowBox[{
   RowBox[{"d", "[", 
    RowBox[{
     RowBox[{"x_", "?", "NumericQ"}], "|", "x_d"}], "]"}], "=", "0"}], ";", 
  RowBox[{
   RowBox[{"d", "[", 
    RowBox[{"Power", "[", 
     RowBox[{"y_", ",", "n_"}], "]"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"n", " ", 
     RowBox[{"y", "^", 
      RowBox[{"(", 
       RowBox[{"n", "-", "1"}], ")"}]}], " ", 
     RowBox[{"d", "[", "y", "]"}]}], "+", 
    RowBox[{
     RowBox[{"y", "^", "n"}], " ", 
     RowBox[{"Log", "[", "y", "]"}], 
     RowBox[{"d", "[", "n", "]"}]}]}]}], ";", 
  RowBox[{
   RowBox[{"d", "[", "x_Plus", "]"}], ":=", 
   RowBox[{"d", "/@", "x"}]}], ";", 
  RowBox[{
   RowBox[{"HoldPattern", "[", 
    RowBox[{"d", "[", 
     RowBox[{"Bar", "[", "x_", "]"}], "]"}], "]"}], ":=", 
   RowBox[{"With", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"evalHx", "=", 
       RowBox[{"d", "[", "x", "]"}]}], "}"}], ",", 
     RowBox[{
      RowBox[{"Bar", "[", "evalHx", "]"}], "/;", 
      RowBox[{
       RowBox[{"Head", "[", "evalHx", "]"}], "=!=", "d"}]}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"d", "[", 
    RowBox[{"x_Rule", "|", "x_Equal"}], "]"}], ":=", 
   RowBox[{"reWrite", "[", 
    RowBox[{"d", "/@", "x"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"d", "[", "x_SeriesData", "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{"x", "/.", 
      RowBox[{
       RowBox[{"x", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "->", 
       RowBox[{"d", "[", 
        RowBox[{"x", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "]"}]}]}], ")"}], "+", 
    RowBox[{"Wedge", "[", 
     RowBox[{
      RowBox[{"d", "[", 
       RowBox[{"First", "[", "x", "]"}], "]"}], ",", 
      RowBox[{"D", "[", 
       RowBox[{"x", ",", 
        RowBox[{"First", "[", "x", "]"}]}], "]"}]}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"d", "[", 
    RowBox[{
     RowBox[{"h_", "[", "y__", "]"}], "/;", 
     RowBox[{"!", 
      RowBox[{"MemberQ", "[", 
       RowBox[{"nodHeads", ",", "h"}], "]"}]}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{"Derivative", "[", 
           RowBox[{"Sequence", "@@", 
            RowBox[{"RotateRight", "[", 
             RowBox[{
              RowBox[{"Append", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"{", "y", "}"}], "]"}], "-", "1"}], "}"}]}], 
                 "]"}], ",", "1"}], "]"}], ",", "i"}], "]"}]}], "]"}], "[", 
          "h", "]"}], "[", "y", "]"}], ")"}], 
       RowBox[{"d", "[", 
        RowBox[{
         RowBox[{"{", "y", "}"}], "[", 
         RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", 
        RowBox[{"Length", "[", 
         RowBox[{"{", "y", "}"}], "]"}]}], "}"}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{
      RowBox[{"FormDegree", "[", 
       RowBox[{"h", "[", "y", "]"}], "]"}], "===", "0"}], "&&", 
     RowBox[{"!", 
      RowBox[{"MemberQ", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"Integer", ",", "Blank", ",", "Pattern", ",", "Condition"}], 
         "}"}], ",", 
        RowBox[{"Head", "[", 
         RowBox[{"First", "[", 
          RowBox[{"{", "y", "}"}], "]"}], "]"}]}], "]"}]}]}]}]}], 
  ";"}]], "Input",
 CellLabel->"In[14]:=",ExpressionUUID->"2bfabfc1-3ada-4d5f-8868-d6888ae9c26b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"newSer$", "[", 
   RowBox[{"x_SeriesData", ",", "k_"}], "]"}], ":=", 
  RowBox[{"SeriesData", "[", 
   RowBox[{
    RowBox[{"First", "[", "x", "]"}], ",", 
    RowBox[{"x", "[", 
     RowBox[{"[", "2", "]"}], "]"}], ",", 
    RowBox[{"Flatten", "[", 
     RowBox[{"Transpose", "[", 
      RowBox[{"Prepend", "[", 
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Table", "[", 
           RowBox[{"0", ",", 
            RowBox[{"{", 
             RowBox[{"Length", "[", 
              RowBox[{"x", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "]"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"k", "-", "1"}], "}"}]}], "]"}], ",", 
        RowBox[{"x", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "]"}], "]"}], ",", 
    RowBox[{"k", " ", 
     RowBox[{"x", "[", 
      RowBox[{"[", "4", "]"}], "]"}]}], ",", 
    RowBox[{"k", " ", 
     RowBox[{"x", "[", 
      RowBox[{"[", "5", "]"}], "]"}]}], ",", 
    RowBox[{"k", " ", 
     RowBox[{"Last", "[", "x", "]"}]}]}], "]"}]}]], "Input",
 CellLabel->"In[15]:=",ExpressionUUID->"a5c9e650-9f60-4f23-b8bc-a48da4cc0593"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Wedge", "[", "x_", "]"}], ":=", 
  RowBox[{"x", "/;", 
   RowBox[{
    RowBox[{
     RowBox[{"Length", "[", 
      RowBox[{"{", "x", "}"}], "]"}], "<", "2"}], "&&", 
    RowBox[{
     RowBox[{"Head", "[", 
      RowBox[{
       RowBox[{"{", "x", "}"}], "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}], "=!=", 
     "Pattern"}]}]}]}]], "Input",
 CellLabel->"In[16]:=",ExpressionUUID->"54d7ec57-2dd6-4b2b-81be-0740dcd518b0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Default", "[", "Wedge", "]"}], ":=", "1"}], ";", 
  RowBox[{"SetAttributes", "[", 
   RowBox[{"Wedge", ",", 
    RowBox[{"{", 
     RowBox[{"Flat", ",", "OneIdentity"}], "}"}]}], "]"}], ";", 
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"0", ",", "y__"}], "]"}], "=", "0"}], ";", 
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"x__", ",", "0"}], "]"}], "=", "0"}], ";", 
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"x_SeriesData", ",", "y_SeriesData"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "x$", ",", "y$", ",", "r1", ",", "r2", ",", "res", ",", "x3", ",", 
        "y3"}], "}"}], ",", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Last", "[", "x", "]"}], "===", 
          RowBox[{"Last", "[", "y", "]"}]}], ",", 
         RowBox[{
          RowBox[{"x$", "=", "x"}], ";", 
          RowBox[{"y$", "=", "y"}]}], ",", 
         RowBox[{
          RowBox[{"x$", "=", 
           RowBox[{"newSer$", "[", 
            RowBox[{"x", ",", 
             RowBox[{
              RowBox[{"LCM", "[", 
               RowBox[{
                RowBox[{"Last", "[", "x", "]"}], ",", 
                RowBox[{"Last", "[", "y", "]"}]}], "]"}], "/", 
              RowBox[{"Last", "[", "x", "]"}]}]}], "]"}]}], ";", 
          RowBox[{"y$", "=", 
           RowBox[{"newSer$", "[", 
            RowBox[{"y", ",", 
             RowBox[{
              RowBox[{"LCM", "[", 
               RowBox[{
                RowBox[{"Last", "[", "x", "]"}], ",", 
                RowBox[{"Last", "[", "y", "]"}]}], "]"}], "/", 
              RowBox[{"Last", "[", "y", "]"}]}]}], "]"}]}]}]}], "]"}], ";", 
       RowBox[{"r1", "=", 
        RowBox[{
         RowBox[{"x$", "[", 
          RowBox[{"[", 
           RowBox[{"-", "3"}], "]"}], "]"}], "+", 
         RowBox[{"y$", "[", 
          RowBox[{"[", 
           RowBox[{"-", "3"}], "]"}], "]"}]}]}], ";", 
       RowBox[{"r2", "=", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"x$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "2"}], "]"}], "]"}], "+", 
           RowBox[{"y$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "3"}], "]"}], "]"}]}], ",", 
          RowBox[{
           RowBox[{"x$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "3"}], "]"}], "]"}], "+", 
           RowBox[{"y$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "2"}], "]"}], "]"}]}]}], "]"}]}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"x$", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "<", 
          RowBox[{
           RowBox[{"x$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "2"}], "]"}], "]"}], "-", 
           RowBox[{"x$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "3"}], "]"}], "]"}]}]}], ",", 
         RowBox[{"x3", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"x$", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{"0", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"x$", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "2"}], "]"}], "]"}], "-", 
                RowBox[{"x$", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "3"}], "]"}], "]"}], "-", 
                RowBox[{"Length", "[", 
                 RowBox[{"x$", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
           "]"}]}], ",", 
         RowBox[{"x3", "=", 
          RowBox[{"x$", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}], ";", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"y$", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "]"}], "<", 
          RowBox[{
           RowBox[{"y$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "2"}], "]"}], "]"}], "-", 
           RowBox[{"y$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "3"}], "]"}], "]"}]}]}], ",", 
         RowBox[{"y3", "=", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{"y$", "[", 
             RowBox[{"[", "3", "]"}], "]"}], ",", 
            RowBox[{"Table", "[", 
             RowBox[{"0", ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"y$", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "2"}], "]"}], "]"}], "-", 
                RowBox[{"y$", "[", 
                 RowBox[{"[", 
                  RowBox[{"-", "3"}], "]"}], "]"}], "-", 
                RowBox[{"Length", "[", 
                 RowBox[{"y$", "[", 
                  RowBox[{"[", "3", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
           "]"}]}], ",", 
         RowBox[{"y3", "=", 
          RowBox[{"y$", "[", 
           RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}], ";", 
       RowBox[{"Which", "[", 
        RowBox[{
         RowBox[{"r2", "===", "r1"}], ",", 
         RowBox[{"res", "=", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{
          RowBox[{"r2", "-", "r1"}], "===", 
          RowBox[{
           RowBox[{"x$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "2"}], "]"}], "]"}], "-", 
           RowBox[{"x$", "[", 
            RowBox[{"[", 
             RowBox[{"-", "3"}], "]"}], "]"}]}]}], ",", 
         RowBox[{"res", "=", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{
                 RowBox[{"x3", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", "#"}], "]"}], "&"}], 
              ",", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{"{", 
                   RowBox[{"i", "-", "1"}], "}"}]}], "]"}], ",", 
                RowBox[{"Drop", "[", 
                 RowBox[{"y3", ",", 
                  RowBox[{
                   RowBox[{"-", "i"}], "+", "1"}]}], "]"}]}], "]"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "x3", "]"}]}], "}"}]}], "]"}]}], ",", 
         "True", ",", 
         RowBox[{"res", "=", 
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{"Map", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Wedge", "[", 
                RowBox[{"#", ",", 
                 RowBox[{"y3", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "&"}], ",", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"Table", "[", 
                 RowBox[{"0", ",", 
                  RowBox[{"{", 
                   RowBox[{"i", "-", "1"}], "}"}]}], "]"}], ",", 
                RowBox[{"Drop", "[", 
                 RowBox[{"x3", ",", 
                  RowBox[{
                   RowBox[{"-", "i"}], "+", "1"}]}], "]"}]}], "]"}]}], "]"}], 
            ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", 
              RowBox[{"Length", "[", "y3", "]"}]}], "}"}]}], "]"}]}]}], "]"}],
        ";", 
       RowBox[{"SeriesData", "[", 
        RowBox[{
         RowBox[{"First", "[", "x$", "]"}], ",", 
         RowBox[{"x$", "[", 
          RowBox[{"[", "2", "]"}], "]"}], ",", "res", ",", "r1", ",", "r2", 
         ",", 
         RowBox[{"Last", "[", "x$", "]"}]}], "]"}]}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{
      RowBox[{"First", "[", "x", "]"}], "===", 
      RowBox[{"First", "[", "y", "]"}]}], "&&", 
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "2", "]"}], "]"}], "===", 
      RowBox[{"y", "[", 
       RowBox[{"[", "2", "]"}], "]"}]}]}]}]}], ";", 
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"y_", ",", "x_SeriesData"}], "]"}], ":=", 
   RowBox[{"x", "/.", 
    RowBox[{
     RowBox[{"x", "[", 
      RowBox[{"[", "3", "]"}], "]"}], "->", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Wedge", "[", 
         RowBox[{"y", ",", "#"}], "]"}], "&"}], ",", 
       RowBox[{"x", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}]}]}], ";", 
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"x_SeriesData", ",", "y_"}], "]"}], ":=", 
   RowBox[{"x", "/.", 
    RowBox[{
     RowBox[{"x", "[", 
      RowBox[{"[", "3", "]"}], "]"}], "->", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Wedge", "[", 
         RowBox[{"#", ",", "y"}], "]"}], "&"}], ",", 
       RowBox[{"x", "[", 
        RowBox[{"[", "3", "]"}], "]"}]}], "]"}]}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"x__", ",", "y_Plus"}], "]"}], ":=", 
   RowBox[{"Plus", "@@", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Wedge", "[", 
        RowBox[{"x", ",", "#"}], "]"}], "&"}], ",", 
      RowBox[{"List", "@@", "y"}]}], "]"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"x_Plus", ",", "y__"}], "]"}], ":=", 
   RowBox[{"Plus", "@@", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Wedge", "[", 
        RowBox[{"#", ",", "y"}], "]"}], "&"}], ",", 
      RowBox[{"List", "@@", "x"}]}], "]"}]}]}], ";", 
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"u__", ",", 
     RowBox[{"Times", "[", 
      RowBox[{"x_", ",", "y_"}], "]"}]}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Times", "[", 
     RowBox[{"x", ",", 
      RowBox[{"Wedge", "[", 
       RowBox[{"u", ",", "y"}], "]"}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{"NumericQ", "[", "x", "]"}], "||", 
     RowBox[{
      RowBox[{"FormDegree", "[", "x", "]"}], "===", "0"}]}]}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{
     RowBox[{"Times", "[", 
      RowBox[{"x_", ",", "y_"}], "]"}], ",", "z__"}], "]"}], ":=", 
   RowBox[{
    RowBox[{"Times", "[", 
     RowBox[{"x", ",", 
      RowBox[{"Wedge", "[", 
       RowBox[{"y", ",", "z"}], "]"}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{"NumericQ", "[", "x", "]"}], "||", 
     RowBox[{
      RowBox[{"FormDegree", "[", "x", "]"}], "===", "0"}]}]}]}], ";", 
  RowBox[{
   RowBox[{
    RowBox[{"x_", "^", "n_."}], "\[Wedge]", "y_"}], " ", ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"x", "^", "n"}], "*", "y"}], "/;", 
    RowBox[{
     RowBox[{"FormDegree", "[", "x", "]"}], "===", "0"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"y_", "\[Wedge]", 
    RowBox[{"x_", "^", "n_."}]}], ":=", 
   RowBox[{
    RowBox[{
     RowBox[{"x", "^", "n"}], "*", "y"}], "/;", 
    RowBox[{
     RowBox[{"FormDegree", "[", "x", "]"}], "===", "0"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"Wedge", "[", 
    RowBox[{"x_", ",", "y___", ",", "x_"}], "]"}], ":=", 
   RowBox[{"0", "/;", 
    RowBox[{
     RowBox[{"OddQ", "[", 
      RowBox[{"FormDegree", "[", "x", "]"}], "]"}], "&&", 
     RowBox[{"ScalFormQ", "[", "x", "]"}]}]}]}], ";", 
  RowBox[{
   RowBox[{"Wedge", "[", "x__", "]"}], ":=", 
   RowBox[{
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"doubL", "=", 
        RowBox[{"Transpose", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"FormDegree", "/@", 
            RowBox[{"{", "x", "}"}]}], ",", 
           RowBox[{"{", "x", "}"}]}], "}"}], "]"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{"Signature", "[", 
        RowBox[{"Select", "[", 
         RowBox[{"doubL", ",", 
          RowBox[{
           RowBox[{"OddQ", "[", 
            RowBox[{"First", "[", "#", "]"}], "]"}], "&"}]}], "]"}], "]"}], 
       RowBox[{"Wedge", "@@", 
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Last", "[", "#1", "]"}], "&"}], ",", 
          RowBox[{"Sort", "[", "doubL", "]"}]}], "]"}]}]}]}], "]"}], "/;", 
    RowBox[{
     RowBox[{
      RowBox[{"Union", "[", 
       RowBox[{"BasicScalFormQ", "/@", 
        RowBox[{"{", "x", "}"}]}], "]"}], "===", 
      RowBox[{"{", "True", "}"}]}], "&&", 
     RowBox[{
      RowBox[{"Map", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Last", "[", "#1", "]"}], "&"}], ",", 
        RowBox[{"Sort", "[", 
         RowBox[{"Transpose", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"FormDegree", "/@", 
             RowBox[{"{", "x", "}"}]}], ",", 
            RowBox[{"{", "x", "}"}]}], "}"}], "]"}], "]"}]}], "]"}], "=!=", 
      RowBox[{"{", "x", "}"}]}]}]}]}], ";"}]}], "Input",
 CellLabel->"In[17]:=",ExpressionUUID->"95288f3d-7575-47c0-8320-2dae5d8b1f41"],

Cell[BoxData[
 RowBox[{
  RowBox[{"simpRules", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Cos", "[", "z_", "]"}], "^", "2"}], "*", 
       RowBox[{"(", "x_.", ")"}]}], "+", 
      RowBox[{
       RowBox[{"(", "x_.", ")"}], "*", 
       RowBox[{
        RowBox[{"Sin", "[", "z_", "]"}], "^", "2"}]}]}], " ", "->", " ", 
     "x"}], "}"}]}], ";", 
  RowBox[{"varList", "=", 
   RowBox[{"{", "}"}]}], ";"}]], "Input",
 CellLabel->"In[23]:=",ExpressionUUID->"a9811702-6edd-4b49-9ef1-a80ed3cf7cf7"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"coll", "[", "x_", "]"}], ":=", 
   RowBox[{"Collect", "[", 
    RowBox[{"x", ",", 
     RowBox[{"{", 
      RowBox[{"_Wedge", ",", "_tr"}], "}"}], ",", "Factor"}], "]"}]}], 
  ";"}]], "Input",
 CellLabel->"In[24]:=",ExpressionUUID->"54906597-7303-49fb-a432-ce5b3268a583"],

Cell[BoxData[
 RowBox[{
  RowBox[{"SetAttributes", "[", 
   RowBox[{"reWrite", ",", 
    RowBox[{"{", "Listable", "}"}]}], "]"}], ";", 
  RowBox[{
   RowBox[{"reWrite", "[", "0", "]"}], "=", "0"}], ";", 
  RowBox[{
   RowBox[{"reWrite", "[", "x_Equal", "]"}], ":=", 
   RowBox[{"Equal", "[", 
    RowBox[{
     RowBox[{"reWrite", "[", 
      RowBox[{
       RowBox[{"First", "[", "x", "]"}], "-", 
       RowBox[{"Last", "[", "x", "]"}]}], "]"}], ",", "0"}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"reWrite", "[", "x_Rule", "]"}], ":=", 
   RowBox[{"Rule", "[", 
    RowBox[{
     RowBox[{"First", "[", "x", "]"}], ",", 
     RowBox[{"reWrite", "[", 
      RowBox[{"Last", "[", "x", "]"}], "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"reWrite", "[", "x_SeriesData", "]"}], ":=", 
   RowBox[{"(", 
    RowBox[{"x", "/.", 
     RowBox[{
      RowBox[{"x", "[", 
       RowBox[{"[", "3", "]"}], "]"}], "->", 
      RowBox[{"reWrite", "[", 
       RowBox[{"x", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "]"}]}]}], ")"}]}], ";", 
  RowBox[{
   RowBox[{"reWrite", "[", "x_", "]"}], ":=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Collect", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"coll", "[", "x", "]"}], "/.", "simpRules"}], ",", 
        "FormVars", ",", "bestFacRul"}], "]"}], "/.", "simpRules"}], ")"}], "/;", 
    RowBox[{
     RowBox[{"FormDegree", "[", "x", "]"}], ">", "0"}]}]}], ";", 
  RowBox[{
   RowBox[{"reWrite", "[", "x_", "]"}], ":=", 
   RowBox[{
    RowBox[{"bestFacRul", "[", 
     RowBox[{"x", "/.", "simpRules"}], "]"}], "/.", "simpRules"}]}], 
  ";"}]], "Input",
 CellLabel->"In[25]:=",ExpressionUUID->"6cdfc064-e1dd-4265-8c10-e6312a362ddf"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"FreeALLQ", "[", 
    RowBox[{"x_", ",", "y_List"}], "]"}], ":=", 
   RowBox[{"And", "@@", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"FreeQ", "[", 
        RowBox[{"x", ",", "#"}], "]"}], "&"}], ",", "y"}], "]"}]}]}], 
  ";"}]], "Input",
 CellLabel->"In[26]:=",ExpressionUUID->"e15a3158-871d-410e-813b-7f8bd9ba607e"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"bestFacRul", "[", "x_", "]"}], ":=", 
   RowBox[{"If", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"varList", "===", 
       RowBox[{"{", "}"}]}], "||", 
      RowBox[{"FreeALLQ", "[", 
       RowBox[{"x", ",", "varList"}], "]"}]}], ",", 
     RowBox[{"minFacRul", "[", "x", "]"}], ",", 
     RowBox[{"varFacRul", "[", "x", "]"}]}], "]"}]}], ";", 
  RowBox[{
   RowBox[{"varFacRul", "[", "x_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Collect", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Expand", "[", "x", "]"}], "/.", "simpRules"}], ",", "varList",
       ",", "Factor"}], "]"}], "/.", "simpRules"}]}], ";", 
  RowBox[{
   RowBox[{"minFacRul", "[", "x_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Factor", "[", 
     RowBox[{
      RowBox[{"Expand", "[", "x", "]"}], "/.", "simpRules"}], "]"}], "/.", 
    "simpRules"}]}], ";"}]], "Input",
 CellLabel->"In[27]:=",ExpressionUUID->"4dc4d1b5-fbf4-438b-955b-c240472b69db"],

Cell[BoxData[
 RowBox[{
  RowBox[{"Unprotect", "[", "SeriesData", "]"}], ";", 
  RowBox[{"If", "[", 
   RowBox[{
    RowBox[{"$VersionNumber", "<", "5"}], ",", 
    RowBox[{
     RowBox[{"Times", "[", 
      RowBox[{"x_SeriesData", ",", "0"}], "]"}], "^=", "0"}]}], "]"}], ";", 
  RowBox[{
   RowBox[{"SeriesData", "[", 
    RowBox[{
    "x1_", ",", "x2_", ",", "x3_", ",", "x4_", ",", "x5_", ",", "x6_"}], 
    "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"Plus", "@@", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"x2", "===", "Infinity"}], ",", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], "/", 
            RowBox[{"x1", "^", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x4", "+", 
                 RowBox[{"Last", "[", "#", "]"}], "-", "1"}], ")"}], "/", 
               "x6"}], ")"}]}]}], "&"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"x3", ",", 
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", "x3", "]"}], "]"}]}], "}"}], "]"}]}], 
         "]"}], "+", 
        RowBox[{"SeriesData", "[", 
         RowBox[{"x1", ",", "x2", ",", 
          RowBox[{"{", "}"}], ",", "x4", ",", "x5", ",", "x6"}], "]"}]}], ",",
        "   ", 
       RowBox[{
        RowBox[{"Map", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"First", "[", "#", "]"}], "*", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"x1", "-", "x2"}], ")"}], "^", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"x4", "+", 
                 RowBox[{"Last", "[", "#", "]"}], "-", "1"}], ")"}], "/", 
               "x6"}], ")"}]}]}], "&"}], ",", 
          RowBox[{"Transpose", "[", 
           RowBox[{"{", 
            RowBox[{"x3", ",", 
             RowBox[{"Range", "[", 
              RowBox[{"Length", "[", "x3", "]"}], "]"}]}], "}"}], "]"}]}], 
         "]"}], "+", 
        RowBox[{"SeriesData", "[", 
         RowBox[{"x1", ",", "x2", ",", 
          RowBox[{"{", "}"}], ",", "x4", ",", "x5", ",", "x6"}], "]"}]}]}], 
      "]"}]}], "/;", 
    RowBox[{"!", 
     RowBox[{"FreeQ", "[", 
      RowBox[{"x3", ",", "x1"}], "]"}]}]}]}], ";", 
  RowBox[{"Protect", "[", "SeriesData", "]"}], ";"}]], "Input",
 CellLabel->"In[28]:=",ExpressionUUID->"520bb3af-f031-4439-bdf8-37865fc717b2"],

Cell[BoxData[
 RowBox[{
  RowBox[{"On", "[", 
   RowBox[{
    RowBox[{"General", "::", "\"\<spell\>\""}], ",", 
    RowBox[{"General", "::", "\"\<spell1\>\""}], ",", 
    RowBox[{"UpSet", "::", "\"\<write\>\""}]}], "]"}], ";"}]], "Input",
 CellLabel->"In[29]:=",ExpressionUUID->"8a290fc1-df77-45a3-8345-f55994da6373"]
}, Open  ]]
}, Open  ]]
},
CellGrouping->Manual,
WindowSize->{1920, 1037},
WindowMargins->{{0, Automatic}, {Automatic, 18}},
PrivateNotebookOptions->{"VersionedStylesheet"->{"Default.nb"[8.] -> False}},
FrontEndVersion->"12.0 for Linux x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb",
MacintoshSystemPageSetup -> \
"0040001804P000000aP2I0000003609To`83609T0@00001804P000000aP2I001\n\
0@00I00100000@0200000BL?00400000000000000000051`I6H0I00000000000\n\
00000000000000000000000000000000"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 206, 6, 48, "Text",ExpressionUUID->"29db9172-b6ba-4ad9-a079-d3917fd855d2"],
Cell[789, 30, 147, 3, 35, "Text",ExpressionUUID->"6a494ef2-5086-4bc7-9685-3092d89ed233"],
Cell[CellGroupData[{
Cell[961, 37, 371, 8, 37, "Text",ExpressionUUID->"32894a4d-3ddb-47db-9cc3-529cb25fb670"],
Cell[1335, 47, 375, 9, 31, "Input",ExpressionUUID->"03ffd62a-9899-451f-a3a7-dbfb968a30bd"],
Cell[1713, 58, 645, 15, 31, "Input",ExpressionUUID->"28e5bde6-027d-4dcd-8969-337d25f590f2"],
Cell[2361, 75, 812, 24, 216, "Input",ExpressionUUID->"7942a5b2-d282-4ce3-9ea5-478fcd31be66"],
Cell[3176, 101, 743, 21, 31, "Input",ExpressionUUID->"2966ac07-4dcd-40d1-ac71-a0e46a15a584"],
Cell[3922, 124, 3227, 96, 217, "Input",ExpressionUUID->"1fbb3465-c1da-4f3e-bf89-817d941419fd"],
Cell[7152, 222, 2006, 61, 147, "Input",ExpressionUUID->"c3e870bb-c655-4ceb-97a4-98dde1fe3a82"],
Cell[9161, 285, 4607, 121, 401, "Input",ExpressionUUID->"3136833c-22c8-4d1e-a891-d943003ce84c"],
Cell[13771, 408, 374, 10, 31, "Input",ExpressionUUID->"dd1385e9-f66b-42b7-a105-4af8a47ac46c"],
Cell[14148, 420, 427, 11, 31, "Input",ExpressionUUID->"7c015e9e-4d8f-4866-ba78-e0afb2ea2f5d"],
Cell[14578, 433, 592, 16, 33, "Input",ExpressionUUID->"0f81c061-325c-4024-bb4a-d34d2aebfe6c"],
Cell[15173, 451, 4209, 130, 242, "Input",ExpressionUUID->"2bfabfc1-3ada-4d5f-8868-d6888ae9c26b"],
Cell[19385, 583, 1176, 33, 31, "Input",ExpressionUUID->"a5c9e650-9f60-4f23-b8bc-a48da4cc0593"],
Cell[20564, 618, 460, 14, 31, "Input",ExpressionUUID->"54d7ec57-2dd6-4b2b-81be-0740dcd518b0"],
Cell[21027, 634, 12791, 379, 538, "Input",ExpressionUUID->"95288f3d-7575-47c0-8320-2dae5d8b1f41"],
Cell[33821, 1015, 558, 17, 31, "Input",ExpressionUUID->"a9811702-6edd-4b49-9ef1-a80ed3cf7cf7"],
Cell[34382, 1034, 318, 9, 31, "Input",ExpressionUUID->"54906597-7303-49fb-a432-ce5b3268a583"],
Cell[34703, 1045, 1695, 50, 170, "Input",ExpressionUUID->"6cdfc064-e1dd-4265-8c10-e6312a362ddf"],
Cell[36401, 1097, 390, 12, 31, "Input",ExpressionUUID->"e15a3158-871d-410e-813b-7f8bd9ba607e"],
Cell[36794, 1111, 973, 28, 78, "Input",ExpressionUUID->"4dc4d1b5-fbf4-438b-955b-c240472b69db"],
Cell[37770, 1141, 2516, 71, 147, "Input",ExpressionUUID->"520bb3af-f031-4439-bdf8-37865fc717b2"],
Cell[40289, 1214, 317, 7, 64, "Input",ExpressionUUID->"8a290fc1-df77-45a3-8345-f55994da6373"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)

